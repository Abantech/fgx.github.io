<!doctype html>
<html>
<head>
<title>FGx Open Source projects</title>
<meta charset='utf-8'>
<link rel='icon'  href='favicon.ico' />
</head>
<body>
<script src='http://mrdoob.github.com/three.js/examples/js/Detector.js'></script>
<script src='http://mrdoob.github.com/three.js/build/three.min.js'></script>
<script>

// FGx name space coming soon.  ;-)

	var FGx = FGx || {};
	//var camera, scene, renderer;
	//var geometry, material, mesh;

	init();
	animate();

	function init() {

		document.body.style.cssText = 'font: 600 12pt monospace; max-width: 900px; margin: 0 auto; text-align: center';

		var info = document.createElement( 'div' );
		document.body.appendChild( info );
		info.style.cssText = 'text-align: left;';
		info.innerHTML='<h1><img src="fgx-cap-80x60.png"> FGx Open Source Projects</h1>' +

			'<p>Home page: <a href="http://fgx.ch" target="_blank">fgx.ch</a></p>' +

			'<p><i>22013-03-15 ~ New Go Language repo at <a href="https://github.com/fgx/fgxgobot" target="_blank">https://github.com/fgx/fgxgobot </a> </i></p>' +

			'<h2>Code, Wiki, links and More...</h2>' +

			'<p>For all the repositories: </p>' +

			'<p><a href="http://github.com/fgx/" >http://github.com/fgx/</a></p>' +
			
			'<p>For FGx Globe: </p>' +

			'<p><a href="http://github.com/fgx/fgx-globe" >http://github.com/fgx/fgx-globe</a></p><br>' +
			
			
			'<h2>FGX Globe</h2>' +
			
			'<p>2013-04-28 ~ Current beta: <a href="http://fgx.github.com/fgx-globe/fgx-globe-r3" >FGX Globe R3.2 ~ beta</a></p>' +
			
			'<p>There is a significant new feature in that the airplanes are now all b777 3D models. ' +
				'The issue is that these models are taking longer to load and because of timing (callback) are not getting to the browser in time to be rendered. ' +
				'The quick fix is to keep re-loading the page. After three or so page reloads the models will be in the browser\'s cache and will be displayed. ' +
				'This issue will be dealt with ASAP. ' +
				'The other cool things are in response to Geoff\'s requests and these are the additions to the flight windows. ' +
				'A flight windows with OSM now has a select zoom drop-down list and your current setting is retained after the refresh and in permalinks ' +
				'Also the flight windows now shows a 2D image (courtesy of pigeond.net) of a plane rotated to current heading. ' +
				'</p>' +
				
			'<p>Also there are several smaller tweaks: The number of planes flying is displayed in the app window title bar and in the main menu title bar. ' +
				'The main menu is using smaller text in most places and margins have been adjusted - all without disrupting the jQuery UI themes. ' +
				'And the text on Info, TBD and other pages has been edited and updated. ' +
				'</p>' +
			
			'<p>2013-04-27 ~ Current beta: <a href="http://fgx.github.com/fgx-globe/fgx-globe-r3" >FGX Globe R3.1 ~ beta</a></p>' +
			
			'<p>The drop-down lists have received a lot of attention. It should now be a fairly straightforward process to select a different theme or map. ' +
				'Also what gets closed stays closed. This includes windows that have been closed and flights that have been terminated. ' +
				'More world maps have been added to the globe and the TBD panel is beginning to have a healthy set of issues to fix and features to add. ' +
				'</p>' + 
				
			'<p>Work has also continued on bringing in 3D models of airplanes. ' +
				'The current issue has to with dealing with what to do while waiting during the loading times for the 3D models, ' +
				'but this appears to be a solvable issue. </p>' +
			
			'<p>2013-04-26 ~ Current beta: <a href="http://fgx.github.com/fgx-globe/fgx-globe-r3" >FGX Globe R3 ~ beta</a></p>' +
			
			'<p>This revision begins to feel as if it\s getting somewhere. The code is simpler, shorter and does more than before. ' +
				'In particular there is much better separation between the user interface and the 3D world. ' +
				'The user interface is now built using jQuery UI while the 3D all resides in a separate file embedded in an iframe.</p>' +
				
			'<p>The user interface now provides a table that displays all the flights currently underway. ' +
				'For each flight there is a clickable button that opens a separate window. ' +
				'Multiple windows may be opened - each of which displays the current position and navigation data for a single plane. ' +
				'You may select from a variety of map data sources. ' +
				'The user interface is theme-able with all the standard 20+ jQuery UI themes available at the click of a button. ' +
				'All significant settings are savable as \'permalinks\'. </p>' +
				
			'<p>On the 3D side, the data-handling procedures have been re-written in a much more simple and more straightforward fashion. ' +
				'Also, there first steps have been taken introduce more realistic planes. See below. </p>' +	
				
			'<p>There is still much unfinished work in this build. In particular the only way to remove terminated flights id to reload the window ' +
				'and the only way to completely delete a window is to reset the permalink. ' +
				'And there are several issues with the drop-down lists. ' +
				'Please note that all building and testing has been on Google Chrome. Other browsers will have issues. ' +
				'Other issues are listed in the TBD panel of the main menu. </p>' +	
			
			'<p>Current revision: <a href="http://fgx.github.com/fgx-globe/fgx-globe-r2-dev/" >FGX Globe R2 - dev</a></p>' +

			'<h2>FGx Globe Cookbook Files</h2>' +

			'<p>While working on the next revision of FGx Globe, various demo files showing particular aspects of an issue ' +

			'are being created. Here they are, with most recent file at the top.</p>' +
			
			'<p>2013-04-26 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/load-plane-3d/index.html">load-plane-3d</a></p>' +
			
			'<p>This file is the result of trying to ascretain the complexity of sourcing FOSS 3D models of airplanes on the web, ' +
				'importing them in Blender, simplifying and centering the model, exporting the model in JSON format ' +
				'and then importing the file into a Three.je web page. This file demonstrates several interesting things: ' +
				'It took no more than two hours to source the file, fire up Blender and reignite some memory of its complex user interface, ' +
				'install the Three.js exporter, delete extraneous detail such as landing wheels, export the new file and then create this little demo. ' +
				'Eventually, it would appear that it\'s likely to be possible to convert several planes an hour. </p>' +
				
				'<p>It also looks like there are little or no performance issues with Three.js with loading a number of nearly but not completely identical models. ' +
				'Note that each is a different color, but each could wear a different bitmap. </p>' +
			
			'<p>2013-04-19 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/j3que-fgx-r1/index.html" >j3qUE FGx r1</a></p>' +

			'<p>A proposed user experience/interface for FGx Globe based on jQuery UI. ' + 
				'Includes the abilities to select a theme and to save all current settings as permalinks.</p>' +

			'<p>2013-04-13 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/airports-runways-navaids-r2/index.html" target="_blank">airports-runways-navaids r2.4</a> - no changes in file name</p>' +
				
			'<p>Adds images of airports, links and more.</p>' +

			'<p>2013-03-20 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/airports-runways-navaids-r2/index.html" target="_blank">airports-runways-navaids r2.3</a> - no changes in file name</p>' +

			'<p>Code cleanup and fixes. Preparing to bring the planes back in</p>' +

			'<p>2013-03-19 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/airports-runways-navaids-r2/index.html" target="_blank">airports-runways-navaids r2.2</a> - no changes in file name</p>' +

			'<p>Geoff\'s navaids data has been folded into the mix. There is now mousewheel support. And the app is fully name space compliant.</p>' +

			'<p>2013-03-18 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/airports-runways-navaids-r2/index.html" target="_blank">airports-runways-navaids r2.1</a> - no changes in file name</p>' +

			'<p>Leaving the test case sceanrios and heading towards a usable user interface: ' +
				'Distances are now calculated from the camera position rather than a separate object. ' +
				'The number of airports displayed now relates to altitude and distance from camera. ' +
				'Plus nemerous changes to the display of text output.</p>' +

			'<p>2013-03-17 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/airports-runways-navaids-r2/index.html" target="_blank">airports-runways-navaids r2</a></p>' +


			'<p>Fixes heads-up display issues. Adds bitmaps. Some code clean-up. Runways and navaids display: not displayed for the moment.</p>' +

			'<p>2013-03-11 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/airports-runways-navaids/index.html" target="_blank">airports-runways-navaids</a>.</p>' +

			'<p>This is a later edition of one of the earlier apps. It loads the data for the 27K airports as well as runways and navaids from ourairports.com.</p>' +

			'<p>Each cube represents an airport. As you move your cursor over one of the cubes, the runway data details and nearby navigational aids are displayed in the \'Readout\' sidebar.</p>' +

			'<p>2013-03-05 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/open-geoff-file-head-ups-only-nearby.html" target="_blank">open-geoff-file-head-ups-only-nearby.html</a>.</p>'  +

			'<p>This app loads and shows details of 27,000 airports nearest to a movable reference point. It uses a mouseover \'heads-p\' pop-up to display data. </p>' +

			'<p>2013-03-05 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/globe-circumscribe-airports.html" target="_blank">globe-circumscribe-airports.html</a>.</p>' +

			'<p>As above with a nicer globe circumscribing user interface.</p>' +

			'<p>2013-03-05 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/globe-circumscribe-airports-2k-only.html" target="_blank">globe-circumscribe-airports-2k-only</a>.</p>' +

			'<p>What does a globe with 2,134 airports look like? Crowded in some places. Empty in other places. BTW, France sure has a lot of airports.</p>' +

			'<p>See the globe at the top right corner of this page for a subset of the features - this globe has no heads-up, etc..</p>' +

			'<p>2013-03-04 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/open-geoff-file-show-only-nearby.html" target="_blank">Open Geoff\'s file show only nearby</a>. ' +

			'<p>Loads the data file with 27,000 airports, but displays only the cubes representing airports that are close to the tracking sphere. ' +
				'This demo appears to airports that may be of immediate interest to the pilot and yet allow for an acceptable FPS.</p>' +

			'<p>2013-03-03 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/open-geoff-file-and-find-nearby.html" target="_blank">Open Geoff\'s file and find nearby</a>. ' +

			'Loads 27,000 airports and places a cube for each in 3D space. Allows you move a sphere using the X, Y, and Z slider bars. ' +

			'The cubes within a selectable nearby range of the tracking sphere are highlighted.</p>' +

			'<p>This demo will mostl likely bring your computer to its knees. The fan should turn on, the FPS will drop to below 5. </p>' +

			'<p>The issue at stake: Can we provide this data - along with pretty titles and mouseover capabilities and so on - and still attain 25 FPS?</p>' +

			'<p><a href="http://fgx.github.com/fgx-globe/cookbook/open-geoff-file-and-display.html" target="_blank">Open Geoff\'s file and display</a>. ' +
			'Loads 27,000 airports and places a cube for each in 3D space. Takes long time to load.</ul></p>' +

			'<p>2013-03-02 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/find-nearby.html" target="_blank">Find nearby</a>. Highlight objects nearby a movable point of interest in 3D space.</p>' +

			'<p>2013-03-02 ~ <a href="http://fgx.github.com/fgx-globe/cookbook/globe-circumscribe.html" target="_blank">Globe Circumscribe</a>. Investigating ways of moving the camera around a globe.</p>' +

			'<br>' +

			'<h2><a href="./fgx-globe/fgx-globe-r2-dev/" >FGX Globe R2 - dev</a></h2>' +

			'<h3>2013-02-28</h3>' +

			'<p>All global variables have been incoporated into the FGx name space. This was easier than anticipated ' +
			'and offers unanticipated benefits in that with the addition of just a few keystrokes all variable values may be persused in the JavaScript console</p>' +

			'<p>And a lot of other cool 3D/2D wormhole stuff was done as well...</p>' +

			'<h3>2013-02-27</h3>' +

			'<p>The beginning of an API via query string has been added. Currently you can set the intitial view by adjusting the default ' +
				'camera latitude, longitude and radius. Other variables include being able to set the airplane scale, altitude scale, ' +
				'refresh rate as well as controlling the rate of movement of your pointing device.</p>' +

			'<p>The following are some URLs with query strings that you may try out:</p>'	+

			'<p><a href="./fgx-globe/fgx-globe-r2-dev/index.html" target="_blank">Default - no query string</a></p>' +
			'<p><a href="./fgx-globe/fgx-globe-r2-dev/index.html?lat=37.5&lon=-122.2&rad=58&ps=0.5&dd=1&rr=3" target="_blank">SFO</a></p>' +
			'<p><a href="./fgx-globe/fgx-globe-r2-dev/index.html?lat=48&lon=7&rad=75&ps=0.5&dd=1&rr=8" target="_blank">Western Europe</a></p>' +
			'<p><a href="./fgx-globe/fgx-globe-r2-dev/index.html?lat=35.6&lon=139.7&rad=85&ps=5&dd=0.5&rr=8" target="_blank">Japan</a></p>' +
			'<p><a href="./fgx-globe/fgx-globe-r2-dev/index.html?lat=-33.8&lon=153&rad=85&ps=5&dd=0.5&rr=8" target="_blank">OZ/NZ</a></p>' +
			'<p><a href="./fgx-globe/fgx-globe-r2-dev/index.html?lat=-20&lon=-60&rad=120&ps=8&dd=0.2&rr=8" target="_blank">South America</a></p>' +

			'<p>For further details please the ' +
			'<a href="https://github.com/fgx/fgx-globe/wiki/FGX-Globe-API-Documentation" target="_blank">FGX Globe API Documentation</a>.</p>' +

			'<h3>2013-02-26</h3>' +

			'<p>R2 code has been copied to a new folder - at the link provided above.</p>' +

			'<p>Development work will continue from here. From time to time the code will be copied to the R2 or \'build\' folder.</p>' +

			'<p>Progress for the day included re-jigging the placard and heads-up displays to follow Geoff\'s requests. ' +
			'Thumbnail images of the planes (where available) are displayed in the heads-up.</p>' +

			'<h2><a href="http://fgx.github.com/fgx-globe/fgx-globe-r2/" >FGX Globe R2</a></h2>' +

			'<p>2013-02-25 ~ Fixed bugs, added comments, streamlined the code and added new features. What more could you ask for?</p>' +

			'<p>Some of the highlights of the release are that planes not being updated by CrossFeed are being \'mothballed\' and removed from the flight view. ' +

			'The display now now tells you how many planes are currently flying and have flown in the current session. ' +

			'There is a pretty new Equator indicator. ' +

			'The skywriting feature is now back in operation. And, propellers are back where they should be - on the front of the plane. ' +

			'</p>' +

			'<h2><a href="http://fgx.github.com/fgx-globe/fgx-globe-r1/fgx-globe-r1.html" >FGX Globe R1</a></h2>' +
			'<p>2013-02-23 ~ This was the first release after being renamed and moved over from being <a href="http://jaanga.github.com/urdacha/globe-demos/globe04-lookat/globe04-lookat.html" >Data Globe #4</a> at ' +
			'<a href="http://jaanga.github.com/urdacha/">Urdacha</a>. ' +

			'<p>FGX Globe acquires data from <a href="http://www.fgx.ch/" target="_blank">FGX</a>, ' +

			'a special effects group hosted in Switzerland. FGX builds add-ons for <a href="http://www.flightgear.org/">FlightGear</a> - the popular FOSS flight simulator. ' +

			'FGX Globe talks to FGX\'s <a href="http://crossfeed.fgx.ch/data" target="_blank">Crossfeed</a> near real-time data feed which shows all the Internet-connected FlightGear planes currently in the air.</p>' +

			'The release adds headings being updated, plane and alitutude scaling, North and South Poles, inactive planes being grayed as well as a number of code clean-ups. ' +

			'</p>';


		FGx.camera = new THREE.PerspectiveCamera( 75, 1, 1, 1000 );
		FGx.camera.position.set ( 0, 0, 350 );

		FGx.scene = new THREE.Scene();

		// FGx.geometry = new THREE.IcosahedronGeometry( 200, parseInt( Math.random() * 5 ) );
		// FGx.material = new THREE.MeshBasicMaterial( { color: 0xffffff * Math.random(), wireframe: true, wireframeLinewidth: parseInt( Math.random() * 8) } );
		FGx.objects = new THREE.Object3D();

		FGx.geometry = new THREE.IcosahedronGeometry( 200, 3 );
		FGx.material = new THREE.MeshNormalMaterial();

		FGx.mesh = new THREE.Mesh( FGx.geometry, FGx.material );
		FGx.objects.add( FGx.mesh );

		if ( ! Detector.webgl ) {
			FGx.renderer = new THREE.CanvasRenderer( { antialias: true } );
		} else {
			FGx.renderer = new THREE.WebGLRenderer( { antialias: true } );
		}

		FGx.renderer.setSize( 300, 300 );
		FGx.renderer.domElement.style.cssText = 'border: solid red 0px; right: 0; position: absolute; top: 0;';
		FGx.renderer.domElement.title = 'Each of the 2,123 cubes represents an airport';

		document.body.appendChild( FGx.renderer.domElement );

		loadCSV('ap1000-ils.csv');
	}

	function animate() {
		requestAnimationFrame( animate );
		if ( FGx.objects ) {
			FGx.objects.rotation.x = Date.now() * 0.00002;
			FGx.objects.rotation.y = Date.now() * 0.0002;
		}
		FGx.renderer.render( FGx.scene, FGx.camera );
	}

	function loadCSV( fname ) {
		xmlhttp = new XMLHttpRequest();
		xmlhttp.open( 'GET', fname, true );
		xmlhttp.onreadystatechange = callback;
		xmlhttp.send( null );
	}

	var callbackCount = 0;

	function callback() {
		if ( xmlhttp.readyState == 4  ) {
			var dataLines = xmlhttp.responseText;
			dataLines = dataLines.split(/\r\n|\n/);
			var dataLength = dataLines.length;
			var separator = ',';
			data = [];
			for ( var i = 0; i < dataLength; i++ ) {
				data.push( dataLines[i].split( separator ) );
			}
			addAirports();
		} else {
			console.log('waiting...');
		}
	}

	function addAirports() {
		var ap;
		var geometry = new THREE.CubeGeometry( 5, 5, 5);
		var material = new THREE.MeshNormalMaterial();

		for (var i = 1, len = data.length - 1; i < len; i++) {
			ap = data[i];
			cube = new THREE.Mesh( geometry, material );
			cube.position = calcPosition( ap[2], ap[3], 201 );
			cube.ap = ap;
			FGx.objects.add( cube );
		}
		FGx.scene.add( FGx.objects );
	}

	function v(x,y,z){ return new THREE.Vector3(x,y,z); }
	function cos(a){return Math.cos(a);} function sin(a){return Math.sin(a);}

	function calcPosition( lat, lon, rad ) {
		var pi = Math.PI, d2r = Math.PI / 180;
		return  v(
			rad * cos( lat * d2r ) * cos( pi - lon * d2r),
			rad * sin( lat * d2r ),
			rad * cos( lat * d2r ) * sin( pi - lon * d2r)
		);
	}
</script>
</body>
</html>